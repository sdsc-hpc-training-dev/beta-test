<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="Compiling &amp;amp; Linking Code In this Section: Compiling &amp;amp; Linking Supported Compiler Types Using the AMD Compilers Using the Intel Comp..."> <meta name="revised" content="9f3d20fc9f265e710b3d423c39319b80134629e1"> <meta name="author" content="sdsc-hpc-training-dev"> <meta name="generator" content="jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>Compiling &amp; Linking Code · beta-test</title> <meta name="twitter:title" content="Compiling &amp; Linking Code · beta-test"> <meta name="twitter:description" content="Compiling &amp;amp; Linking Code In this Section: Compiling &amp;amp; Linking Supported Compiler Types Using the AMD Compilers Using the Intel Comp..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@sdsc-hpc-training-dev"> <meta name="twitter:url" content="http://localhost:4000/expanse-101/docs/compiling.html"> <meta name="twitter:creator" content="@jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="Compiling &amp; Linking Code · beta-test"> <meta property="og:description" content="Compiling &amp;amp; Linking Code In this Section: Compiling &amp;amp; Linking Supported Compiler Types Using the AMD Compilers Using the Intel Comp..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/expanse-101/docs/compiling.html"> <meta property="og:type" content="article"> <meta property="article:author" content="sdsc-hpc-training-dev"> <meta property="article:published_time" content="2020-11-24T22:03:23-08:00"> <meta property="article:modified_time" content="2020-11-24T22:48:17-08:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/expanse-101/docs/compiling.html" }, "headline": "Compiling &amp; Linking Code · beta-test", "image": [], "author": { "@type": "Person", "name": "sdsc-hpc-training-dev" }, "datePublished": "2020-11-24T22:03:23-08:00", "dateModified": "2020-11-24T22:48:17-08:00", "publisher": { "@type": "Organization", "name": "sdsc-hpc-training-dev", "logo": { "@type": "ImageObject", "url": "https://avatars3.githubusercontent.com/u/72896835?v=4" } }, "description": "Compiling &amp;amp; Linking Code In this Section: Compiling &amp;amp; Linking Supported Compiler Types Using the AMD Compilers Using the Intel Comp..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="prev" href="http://localhost:4000/expanse-101/docs/accounts.html"><link rel="next" href="http://localhost:4000/expanse-101/docs/expanse_overview.html"><link rel="canonical" href="http://localhost:4000/expanse-101/docs/compiling.html"><link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg"><link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/assets/images/favicon.svg" color="#2980b9"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><script> window.ui = { title: "beta-test", baseurl: "", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/" title="beta-test for SDSC101"> <i class="fa fa-home"></i> beta-test </a> </div> <span class="version"></span> <form class="search pt-2" action="/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/notebooks-101/"> /notebooks-101/ </a><ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/comet-101/"> Comet 101 Tutorial </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/comet-101/running_jobs_on_comet.html">Comet 101: Introduction to Running Jobs on Comet Supercomputer</a> </li></ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/expanse-101/"> Expanse 101 Tutorial </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/expanse-101/running_jobs_on_expanse.html">Expanse 101: Introduction to Running Jobs on the Expanse Supercomputer</a> </li></ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/">beta-test</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" ><a href="/expanse-101/">expanse-101</a></li><li class="breadcrumb-item" ><a href="/expanse-101/docs/">docs</a></li><li class="breadcrumb-item" aria-current="page">compiling.md</li></ul> <a class="edit" href="https://github.com/sdsc-hpc-training-dev/beta-test/edit/gh-pages/expanse-101/docs/compiling.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h2 id="compiling--linking-code"><a name="compilers"></a>Compiling &amp; Linking Code</h2> <p><a name="top"> In this Section:</a></p> <ul> <li><a href="#compilers">Compiling &amp; Linking</a> <ul> <li><a href="#compilers-supported">Supported Compiler Types</a></li> <li><a href="#compilers-intel">Using the AMD Compilers</a></li> <li><a href="#compilers-intel">Using the Intel Compilers</a></li> <li><a href="#compilers-pgi">Using the PGI Compilers</a></li> <li><a href="#compilers-gnu">Using the GNU Compilers</a></li> </ul> </li> </ul> <h3 id="expanse-compilers"><a name="compilers"></a>Expanse Compilers</h3> <p>Expanse provides the Intel, Portland Group (PGI), and GNU compilers along with multiple MPI implementations (MVAPICH2, MPICH2, OpenMPI). Most applications will achieve the best performance on Expanse using the Intel compilers and MVAPICH2 and the majority of libraries installed on Expanse have been built using this combination.</p> <p>Other compilers and versions can be installed by Expanse staff on request. For more information, see the [Expanse User Guide.] (https://www.sdsc.edu/support/user_guides/expanse.html#compiling)</p> <h3 id="supported-compilers"><a name="compilers-supported"></a>Supported Compilers</h3> <p>Expanse CPU and GPU nodes have different compiler libraries.</p> <h4 id="cpu-nodes">CPU Nodes</h4> <ul> <li>GNU, Intel, AOCC (AMD) compilers</li> <li>Multiple MPI implementations (OpenMPI, MVAPICH2, and IntelMPI). </li> <li>A majority of applications have been built using gcc/10.2.0 which features AMD Rome specific optimization flags (-march=znver2).</li> <li>Intel, and AOCC compilers all have flags to support Advanced Vector Extensions 2 (AVX2). </li> </ul> <p>Users should evaluate their application for best compiler and library selection. GNU, Intel, and AOCC compilers all have flags to support Advanced Vector Extensions 2 (AVX2). Using AVX2, up to eight floating point operations can be executed per cycle per core, potentially doubling the performance relative to non-AVX2 processors running at the same clock speed. Note that AVX2 support is not enabled by default and compiler flags must be set as described below.</p> <h4 id="gpu-nodes">GPU Nodes</h4> <p>Expanse GPU nodes have GNU, Intel, and PGI compilers available along with multiple MPI implementations (OpenMPI, IntelMPI, and MVAPICH2). The gcc/10.2.0, Intel, and PGI compilers have specific flags for the Cascade Lake architecture. Users should evaluate their application for best compiler and library selections.</p> <p><em>Note: that the login nodes are not the same as the GPU nodes, therefore all GPU codes must be compiled by requesting an interactive session on the GPU nodes.</em></p> <p>In this tutorial, we include several hands-on examples that cover many of the cases in the table:</p> <ul> <li>MPI</li> <li>OpenMP</li> <li>HYBRID</li> <li>GPU</li> <li>Local scratch</li> </ul> <p><a href="#top">Back to Top</a></p> <hr /> <h3 id="using-the-amd-compilers"><a name="compilers-amd"></a>Using the AMD compilers</h3> <p>The AMD Optimizing C/C++ Compiler (AOCC) is only available on CPU nodes. AMD compilers can be loaded by executing the following commands at the Linux prompt:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>module load aocc
</code></pre>  </div></div> <p>For more information on the AMD compilers run:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>[flang | clang ] -help
</code></pre>  </div></div> <p>Suggested Compilers to used based on programming model and languages:</p> <table> <thead> <tr> <th style="text-align: left">Language</th> <th style="text-align: left">Serial</th> <th style="text-align: left">MPI</th> <th style="text-align: left">OpenMP</th> <th style="text-align: left">MPI + OpenMP</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Fortran</td> <td style="text-align: left">flang</td> <td style="text-align: left">mpif90</td> <td style="text-align: left">ifort -fopenmp</td> <td style="text-align: left">mpif90 -fopenmp</td> </tr> <tr> <td style="text-align: left">C</td> <td style="text-align: left">clang</td> <td style="text-align: left">mpiclang</td> <td style="text-align: left">icc -fopenmp</td> <td style="text-align: left">mpicc -fopenmp</td> </tr> <tr> <td style="text-align: left">C++</td> <td style="text-align: left">clang++</td> <td style="text-align: left">mpiclang</td> <td style="text-align: left">icpc -fopenmp</td> <td style="text-align: left">mpicxx -fopenmp</td> </tr> </tbody> </table> <p><a href="#top">Back to Top</a></p> <hr /> <h3 id="using-the-intel-compilers"><a name="compilers-intel"></a>Using the Intel Compilers:</h3> <p>The Intel compilers and the MVAPICH2 MPI implementation will be loaded by default. If you have modified your environment, you can reload by executing the following commands at the Linux prompt or placing in your startup file (~/.cshrc or ~/.bashrc) or into a module load script (see above).</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>module purge
module load intel mvapich2_ib
</code></pre>  </div></div> <p>For AVX2 support, compile with the -xHOST option. Note that -xHOST alone does not enable aggressive optimization, so compilation with -O3 is also suggested. The -fast flag invokes -xHOST, but should be avoided since it also turns on interprocedural optimization (-ipo), which may cause problems in some instances.</p> <p>Intel MKL libraries are available as part of the "intel" modules on Expanse. Once this module is loaded, the environment variable MKL_ROOT points to the location of the mkl libraries. The MKL link advisor can be used to ascertain the link line (change the MKL_ROOT aspect appropriately).</p> <p>In the example below, we are working with the HPC examples that can be found in</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>[user@expanse-14-01:~/expanse-examples/expanse101/MKL] pwd
/home/user/expanse-examples/expanse101/MKL
[user@expanse-14-01:~/expanse-examples/expanse101/MKL] ls -al
total 25991
drwxr-xr-x  2 user use300        9 Nov 25 17:20 .
drwxr-xr-x 16 user use300       16 Aug  5 19:02 ..
-rw-r--r--  1 user use300      325 Aug  5 19:02 compile.txt
-rw-r--r--  1 user use300     6380 Aug  5 19:02 pdpttr.c
-rwxr-xr-x  1 user use300 44825440 Nov 25 16:55 pdpttr.exe
-rw-r--r--  1 user use300      188 Nov 25 16:57 scalapack.20294236.expanse-07-27.out
-rw-r--r--  1 user use300      376 Aug  5 19:02 scalapack.sb
</code></pre>  </div></div> <p>The file <code class="language-plaintext highlighter-rouge notranslate">compile.txt</code> contains the full command to compile the <code class="language-plaintext highlighter-rouge notranslate">pdpttr.c</code> program statically linking 64 bit scalapack libraries on Expanse:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>[user@expanse-14-01:~/expanse-examples/expanse101/MKL] cat compile.txt
mpicc -o pdpttr.exe pdpttr.c /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_scalapack_lp64.a -Wl,--start-group /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_intel_lp64.a /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_sequential.a /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_core.a /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_blacs_intelmpi_lp64.a -Wl,--end-group -lpthread -lm -ldl
</code></pre>  </div></div> <p>Run the command:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>[user@expanse-14-01:~/expanse-examples/expanse101/MKL] mpicc -o pdpttr.exe pdpttr.c  -I$MKL_ROOT/include ${MKL_ROOT}/lib/intel64/libmkl_scalapack_lp64.a -Wl,--start-group ${MKL_ROOT}/lib/intel64/libmkl_intel_lp64.a ${MKL_ROOT}/lib/intel64/libmkl_core.a ${MKL_ROOT}/lib/intel64/libmkl_sequential.a -Wl,--end-group ${MKL_ROOT}/lib/intel64/libmkl_blacs_intelmpi_lp64.a -lpthread -lm
</code></pre>  </div></div> <p>For more information on the Intel compilers run: [ifort | icc | icpc] -help</p> <p><a href="#top">Back to Top</a></p> <hr /> <h3 id="using-the-pgi-compilers"><a name="compilers-pgi"></a>Using the PGI Compilers</h3> <p>The PGI compilers can be loaded by executing the following commands at the Linux prompt or placing in your startup file (~/.cshrc or ~/.bashrc)</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>module purge
module load pgi mvapich2_ib
</code></pre>  </div></div> <p>For AVX support, compile with -fast</p> <table> <tbody> <tr> <td>For more information on the PGI compilers: man [pgf90</td> <td>pgcc</td> <td>pgCC]</td> </tr> </tbody> </table> <table> <thead> <tr> <th> </th> <th>Serial</th> <th>MPI</th> <th>OpenMP</th> <th>MPI+OpenMP</th> </tr> </thead> <tbody> <tr> <td>pgf90</td> <td>mpif90</td> <td>pgf90 -mp</td> <td>mpif90 -mp</td> <td> </td> </tr> <tr> <td>C</td> <td>pgcc</td> <td>mpicc</td> <td>pgcc -mp</td> <td>mpicc -mp</td> </tr> <tr> <td>C++</td> <td>pgCC</td> <td>mpicxx</td> <td>pgCC -mp</td> <td>mpicxx -mp</td> </tr> </tbody> </table> <p><a href="#top">Back to Top</a></p> <hr /> <h3 id="using-the-gnu-compilers"><a name="compilers-gnu"></a>Using the GNU Compilers</h3> <p>The GNU compilers can be loaded by executing the following commands at the Linux prompt or placing in your startup files (~/.cshrc or ~/.bashrc)</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>module purge
module load gnu openmpi_ib
</code></pre>  </div></div> <p>For AVX support, compile with -mavx. Note that AVX support is only available in version 4.7 or later, so it is necessary to explicitly load the gnu/4.9.2 module until such time that it becomes the default.</p> <table> <tbody> <tr> <td>For more information on the GNU compilers: man [gfortran</td> <td>gcc</td> <td>g++]</td> </tr> </tbody> </table> <table> <thead> <tr> <th> </th> <th>Serial</th> <th>MPI</th> <th>OpenMP</th> <th>MPI+OpenMP</th> </tr> </thead> <tbody> <tr> <td>Fortran</td> <td>gfortran</td> <td>mpif90</td> <td>gfortran -fopenmp</td> <td>mpif90 -fopenmp</td> </tr> <tr> <td>C</td> <td>gcc</td> <td>mpicc</td> <td>gcc -fopenmp</td> <td>mpicc -fopenmp</td> </tr> <tr> <td>C++</td> <td>g++</td> <td>mpicxx</td> <td>g++ -fopenmp</td> <td>mpicxx -fopenmp</td> </tr> </tbody> </table> <p><a href="#top">Back to Top</a></p> <hr /> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"><a href="/expanse-101/docs/accounts.html" class="btn" title="Managing Accounts on Expanse" accesskey="p" rel="prev"> <i class="fa fa-arrow-circle-left"></i> Previous </a></div> <div class="next"><a href="/expanse-101/docs/expanse_overview.html" class="btn" title="" accesskey="n" rel="next"> Next <i class="fa fa-arrow-circle-right"></i> </a></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2020,</span> <a class="text-gray" href="https://github.com/sdsc-hpc-training-dev" rel="noreferrer" target="_blank">sdsc-hpc-training-dev</a> Revision <a class="text-gray" href="https://github.com/sdsc-hpc-training-dev/beta-test/commit/9f3d20fc9f265e710b3d423c39319b80134629e1" title="9f3d20fc9f265e710b3d423c39319b80134629e1" rel="noreferrer" target="_blank">9f3d20f</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> beta-test </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/sdsc-hpc-training-dev/beta-test" title="Stars: 1"> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/sdsc-hpc-training-dev/beta-test/issues" title="Open issues: 0"> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/sdsc-hpc-training-dev/beta-test/zipball/gh-pages" title="Size: 0 Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/" title="beta-test">Software</a> is under the terms of <a href="https://github.com/sdsc-hpc-training-dev/beta-test">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>