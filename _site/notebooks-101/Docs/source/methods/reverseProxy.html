<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="Security with Reverse Proxy Service Connection to Notebook over HTTPS using the Reverse Proxy Service (very secure) Overview The SDSC Reverse Proxy..."> <meta name="revised" content="9f3d20fc9f265e710b3d423c39319b80134629e1"> <meta name="author" content="sdsc-hpc-training-dev"> <meta name="generator" content="jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>Security with Reverse Proxy Service 路 beta-test</title> <meta name="twitter:title" content="Security with Reverse Proxy Service 路 beta-test"> <meta name="twitter:description" content="Security with Reverse Proxy Service Connection to Notebook over HTTPS using the Reverse Proxy Service (very secure) Overview The SDSC Reverse Proxy..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@sdsc-hpc-training-dev"> <meta name="twitter:url" content="http://localhost:4000/notebooks-101/Docs/source/methods/reverseProxy.html"> <meta name="twitter:creator" content="@jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="Security with Reverse Proxy Service 路 beta-test"> <meta property="og:description" content="Security with Reverse Proxy Service Connection to Notebook over HTTPS using the Reverse Proxy Service (very secure) Overview The SDSC Reverse Proxy..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/notebooks-101/Docs/source/methods/reverseProxy.html"> <meta property="og:type" content="article"> <meta property="article:author" content="sdsc-hpc-training-dev"> <meta property="article:published_time" content="2020-11-24T22:03:23-08:00"> <meta property="article:modified_time" content="2020-11-24T22:48:17-08:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/notebooks-101/Docs/source/methods/reverseProxy.html" }, "headline": "Security with Reverse Proxy Service 路 beta-test", "image": [], "author": { "@type": "Person", "name": "sdsc-hpc-training-dev" }, "datePublished": "2020-11-24T22:03:23-08:00", "dateModified": "2020-11-24T22:48:17-08:00", "publisher": { "@type": "Organization", "name": "sdsc-hpc-training-dev", "logo": { "@type": "ImageObject", "url": "https://avatars3.githubusercontent.com/u/72896835?v=4" } }, "description": "Security with Reverse Proxy Service Connection to Notebook over HTTPS using the Reverse Proxy Service (very secure) Overview The SDSC Reverse Proxy..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="prev" href="http://localhost:4000/notebooks-101/Docs/source/methods/httpConnect.html"><link rel="next" href="http://localhost:4000/notebooks-101/Docs/source/methods/tunneling.html"><link rel="canonical" href="http://localhost:4000/notebooks-101/Docs/source/methods/reverseProxy.html"><link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg"><link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/assets/images/favicon.svg" color="#2980b9"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><script> window.ui = { title: "beta-test", baseurl: "", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/" title="beta-test for SDSC101"> <i class="fa fa-home"></i> beta-test </a> </div> <span class="version"></span> <form class="search pt-2" action="/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/notebooks-101/"> /notebooks-101/ </a><ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/comet-101/"> Comet 101 Tutorial </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/comet-101/running_jobs_on_comet.html">Comet 101: Introduction to Running Jobs on Comet Supercomputer</a> </li></ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/expanse-101/"> Expanse 101 Tutorial </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/expanse-101/running_jobs_on_expanse.html">Expanse 101: Introduction to Running Jobs on the Expanse Supercomputer</a> </li></ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/">beta-test</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" ><a href="/notebooks-101/">notebooks-101</a></li><li class="breadcrumb-item" ><a href="/notebooks-101/Docs/">Docs</a></li><li class="breadcrumb-item" ><a href="/notebooks-101/Docs/source/">source</a></li><li class="breadcrumb-item" ><a href="/notebooks-101/Docs/source/methods/">methods</a></li><li class="breadcrumb-item" aria-current="page">reverseProxy.md</li></ul> <a class="edit" href="https://github.com/sdsc-hpc-training-dev/beta-test/edit/gh-pages/notebooks-101/Docs/source/methods/reverseProxy.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h2 id="security-with-reverse-proxy-service">Security with Reverse Proxy Service</h2> <ul> <li>Connection to Notebook over HTTPS using the <a href="https://github.com/sdsc-hpc-training-org/reverse-proxy">Reverse Proxy Service</a> (very secure)</li> </ul> <h3 id="overview">Overview</h3> <p><img src="https://github.com/sdsc-hpc-training-org/notebooks-101/raw/master/Docs/images/Reverse-Proxy-Service-for-Secure-Jupyter-Notebooks-Arch.png?raw=true" alt="arch" /></p> <p>The SDSC Reverse Proxy Service is a prototype system that will allow users to launch standard Jupyter Services on on any Comet compute node using a reverse proxy server using a simple bash script called <code class="language-plaintext highlighter-rouge notranslate">start-jupyter</code>. The notebooks will be hosted on the internal cluster network as an HTTP service using standard jupyter commands. The service will then be made available to the user outside of the cluster firewall as an HTTPS connection between the external users web browser and the reverse proxy server. The goal is to minimize software changes for our users while improving the security of user notebooks running on our HPC systems. The RPS service is capable of running on any HPC system capable of supporting the RP server (needs Apache).</p> <p>Using the RPS is very simple and requires no tunneling and is secure (produces HTTPS URLs). To use RPS, SSH to connect to comet, and make sure that you have the software environment installed on the login node. Verify that you have installed the required software: <code class="language-plaintext highlighter-rouge notranslate">Anaconda</code>, <code class="language-plaintext highlighter-rouge notranslate">conda</code>, <code class="language-plaintext highlighter-rouge notranslate">Jupyter</code> (notebooks, lab), and other Python packages needed for you application.</p> <h3 id="clone-the-rps-repository">Clone the RPS repository</h3> <p>Clone <a href="https://github.com/sdsc-hpc-training-org/reverse-proxy">this</a> repository directly into your comet login node.<br /> <code class="language-plaintext highlighter-rouge notranslate">git clone https://github.com/sdsc-hpc-training-org/reverse-proxy.git</code></p> <h3 id="launching-the-notebook">Launching the Notebook</h3> <p>The <code class="language-plaintext highlighter-rouge notranslate">start-jupyter</code> script performs the following tasks:</p> <ul> <li>Sends a request to the reverse proxy server (RPS) to get a one-time token and a port number</li> <li>Launches the jupyter notebook command using the token and port number.</li> <li>Prints a secure URL containing the token to the terminal, so that the user can copy/paste the URL into a local browser: <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>Your notebook is here:
  https://aversion-runaround-spearman.comet-user-content.sdsc.edu?token=099aa825b1403d58889842ab2c758885
</code></pre>  </div> </div> </li> </ul> <h3 id="usage">Usage</h3> <p><code class="language-plaintext highlighter-rouge notranslate">./start-jupyter [-p &lt;string&gt;] [-d &lt;string&gt;] [-A &lt;string&gt;] [-b &lt;string&gt;] [-t time] [-i]</code></p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>
-p: the partition to wait for. debug or compute
    Default Partition is "compute"
    
-d: the top-level directory of your jupyter notebook
    Default Dir is /home/$USER

-A: the project allocation to be used for this notebook
    Default Allocation is your sbatch system default allocation (also called project or group)
    
-b: the batch script you want to submit with your notebook. Only those in the `batch` folder are supported.
    Default batch script is ./batch/batch_notebook.sh
    
-t: the time to run the notebook. Your account will be charged for the time you put here so be careful.
    Default time is 30 minutes
    
-i: Get extra information about the job you submitted using the script

</code></pre>  </div></div> <p>(If you don't know what $USER is, try this command: <code class="language-plaintext highlighter-rouge notranslate">echo $USER</code>. This is just your comet username)</p> <p>Note that the time positional argument must occur after all the flags. There will be an error if you put any flags after the positional argument.</p> <p><strong>NOTE: Using the script on multiple systems</strong></p> <p>There are minor differences when using the script on Comet vs. Stratus vs. TSCC. TSCC uses a queue system called Torque, whereas Comet and Stratus use Slurm. You will see example notebook and jupyterlab scripts for Torque and Slurm in the RPS repository. The most important thing to notice is that when you run start-jupyter it will automatially run with defaults for the cluster you are using. So you don't need to worry as much about which cluster you're on.</p> <h3 id="example-commands">Example Commands</h3> <p>Start a notebook with all defaults on any system <code class="language-plaintext highlighter-rouge notranslate">./start-jupyter</code></p> <p>Start a jupyterlab session with rest defaults on Comet <code class="language-plaintext highlighter-rouge notranslate">./start-jupyter -b slurm/jupyterlab.sh</code></p> <p>Start a jupyterlab session with rest defaults on TSCC <code class="language-plaintext highlighter-rouge notranslate">./start-jupyter -b torque/jupyterlab.sh</code></p> <p>Start a notebook in the debug queue on Comet only <code class="language-plaintext highlighter-rouge notranslate">./start-jupyter -d ~ -p debug -t 30</code></p> <p>Start a notebook in the compute queue on Comet only <code class="language-plaintext highlighter-rouge notranslate">./start-jupyter -d ~ -A ddp363 -p compute -t 60</code></p> <h3 id="example-output">Example Output</h3> <p>This is your waiting screen. This screen occurs before your batch job is submitted. <img src="https://github.com/sdsc-hpc-training-org/reverse-proxy/blob/master/.examples_images/ex1.png?raw=true" alt="Waiting Screen" /></p> <p>Your notebook is ready to go! <img src="https://github.com/sdsc-hpc-training-org/reverse-proxy/blob/master/.examples_images/ex2.png?raw=true" alt="Notebook Ready" /></p> <p>If you refresh too soon, you may see this page. This is expected and you'll just have to wait. <img src="https://github.com/sdsc-hpc-training-org/reverse-proxy/blob/master/.examples_images/ex3.png?raw=true" alt="Token Mapping" /></p> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"><a href="/notebooks-101/Docs/source/methods/httpConnect.html" class="btn" title="Insecurity with direct node access" accesskey="p" rel="prev"> <i class="fa fa-arrow-circle-left"></i> Previous </a></div> <div class="next"><a href="/notebooks-101/Docs/source/methods/tunneling.html" class="btn" title="Security with SSH Tunneling" accesskey="n" rel="next"> Next <i class="fa fa-arrow-circle-right"></i> </a></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2020,</span> <a class="text-gray" href="https://github.com/sdsc-hpc-training-dev" rel="noreferrer" target="_blank">sdsc-hpc-training-dev</a> Revision <a class="text-gray" href="https://github.com/sdsc-hpc-training-dev/beta-test/commit/9f3d20fc9f265e710b3d423c39319b80134629e1" title="9f3d20fc9f265e710b3d423c39319b80134629e1" rel="noreferrer" target="_blank">9f3d20f</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> beta-test </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/sdsc-hpc-training-dev/beta-test" title="Stars: 1"> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/sdsc-hpc-training-dev/beta-test/issues" title="Open issues: 0"> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/sdsc-hpc-training-dev/beta-test/zipball/gh-pages" title="Size: 0 Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/" title="beta-test">Software</a> is under the terms of <a href="https://github.com/sdsc-hpc-training-dev/beta-test">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>